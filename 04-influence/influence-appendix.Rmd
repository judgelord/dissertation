---
# rmarkdown::render("04-influence/influence-appendix.Rmd")
title: "Policy Influence: Do Public Pressure Campaigns Influence Bureaucratic Policymaking?"
subtitle: "Appendix and Replication Code" 
author: "Devin Judge-Lord"
bibliography: '`r here::here("assets/dissertation.bib")`'
biblio-style: '`r here::here("assets/apsr.bst")`'
link-citations: yes
citecolor: black
editor_options: 
  chunk_output_type: console
output:
    bookdown::html_document2:
      highlight: zenburn
      toc: true
      toc_float: true
      code_folding: hide
      number_sections: false
---

```{r global.options, include=FALSE, cache=FALSE}
# load defaults
source(here::here("code", "setup.R"))
```



# Data

```{r child = "03-influence-data.Rmd"}
```


# Methods 

```{r child = "04-influence-methods.Rmd"}
```

---

# Results 

<!-- THIS IS WHERE THE RESULTS SECTION STARTS ---> 

```{r child = "05-influence-results.Rmd"}
```


```{r local.options, include=FALSE, cache=FALSE}
# overide defaults
knitr::opts_chunk$set(echo = TRUE, 
                      cache = FALSE,
                      fig.path='../figs/')

library(lmerTest)
```


# Additional Descriptives


---

### Organization-level summary counts:

```{r}
# org comments by type 
comments_coded %>% filter(comment_type == "Org") %>%  
  mutate(org_type = str_remove(org_type, ";.*")) %>%
  count(org_type, sort =T) %>% 
  filter(n>1) %>% 
  kable3(caption = " ")

# org comments by sub-type
comments_coded %>% filter(comment_type == "Org") %>%  
  filter(str_detect(org_type, ";")) %>% 
  mutate(org_type_detailed = org_type) %>%
  count(org_type_detailed, sort =T) %>% 
  kable3(caption = " ")
```


---

```{r coded-coalition-congress, include=FALSE, fig.cap= "Lobbying Success by Number of Supportive Comments"}
#FIXME include when I have more MOCs
coalitions_coded %>% 
  drop_na(coalition_type, Coalition_Position) %>% 
  distinct(coalition_comment, coalition_type, coalition_size, coalition_congress, coalition_comments, agency, Coalition_Position) %>%
  ungroup() %>%
  ggplot() +
  aes(y = coalition_congress, x = log(coalition_comments), color = coalition_type) +
  geom_jitter(aes(size = coalition_size), alpha = .5) +
  geom_smooth(se = FALSE, method = "lm")+ 
  facet_grid(Coalition_Position ~ .) 
```


#### Number of supportive comments

```{r coded-coalition-success-comments, fig.cap= "Lobbying Success by Number of Supportive Comments", fig.width=5, fig.height=3}
coalitions_coded %>% 
  drop_na(coalition_type, Coalition_Position) %>% 
  distinct(coalition_comment, coalition_type, coalition_size, coalition_success, coalition_comments, agency, Coalition_Position) %>% 
  ungroup() %>%
  ggplot() +
  aes(y = coalition_success, x = log(coalition_comments), color = coalition_type) +
  geom_jitter(aes(size = coalition_size), alpha = .5) +
  geom_smooth(se = TRUE, method = "lm")

coalitions_coded %>% 
  drop_na(coalition_type, Coalition_Position) %>% 
  distinct(coalition_comment, coalition_type, coalition_size, coalition_success, coalition_comments, agency, Coalition_Position) %>% 
  ungroup() %>%
  ggplot() +
  aes(y = coalition_success, x = log(coalition_comments), color = coalition_type) +
  geom_jitter(aes(size = coalition_size), alpha = .5) +
  geom_smooth(se = FALSE, method = "lm")+ 
  facet_grid(Coalition_Position ~ .)

coalitions_coded %>% 
  drop_na(coalition_type, Coalition_Position) %>% 
  distinct(coalition_comment, coalition_type, coalition_size, coalition_success, coalition_comments, agency, president, Coalition_Position) %>% 
  ungroup() %>%
  ggplot() +
  aes(y = coalition_success, x = log(coalition_comments), color = coalition_type) +
  geom_jitter(aes(size = coalition_size), alpha = .5) +
  geom_smooth(se = FALSE, method = "lm") + 
  #facet_wrap("president")  + 
  facet_grid(Coalition_Position ~ president)
```

#### Coalition Size

(number of supportive organizations)

```{r coded-coalition-success-size, fig.cap= "Lobbying Success by Number of Supportive Comments", fig.width=5, fig.height=3}
coalitions_coded %>% 
  drop_na(coalition_type, Coalition_Position) %>% 
  distinct(coalition_comment, coalition_type, coalition_size, coalition_success, coalition_comments, agency, president, Coalition_Position) %>% 
  ungroup() %>%
  ggplot() +
  aes(y = coalition_success, x = coalition_size, color = coalition_type) +
  geom_jitter(aes(size = coalition_comments ), alpha = .5) +
  geom_smooth(se = FALSE, method = "lm") + 
  facet_grid(Coalition_Position ~ .)+ 
  scale_size_continuous(labels = comma)

coalitions_coded %>% 
  drop_na(coalition_type, Coalition_Position) %>% 
  distinct(coalition_comment, coalition_type, coalition_size, coalition_success, coalition_comments, agency, president, Coalition_Position) %>% 
  ungroup() %>%
  ggplot() +
  aes(y = coalition_success, x = coalition_size, color = coalition_type) +
  geom_jitter(aes(size = coalition_comments ), alpha = .5) +
  geom_smooth(se = FALSE, method = "lm") + 
  #facet_wrap("president") + 
  facet_grid(Coalition_Position ~ president)+ 
  scale_size_continuous(labels = comma)
```

#### The correlation between coalition size and the total number of comments

The total number of form-letter comments is highly correlated with the number of organizations in a coalition.

The total number of comments excludes organization comments. 

```{r coalition-size-mass-correlation, out.width="25%", fig.width=2.5, fig.height=2.5}
coalitions_coded %>% 
  ggplot() + 
  aes(x = coalition_size, y = comments) +
  geom_point() + 
  geom_smooth(method = "lm") + 
  labs(y = "Mass Comments",
       x = "Coalition Size\n(number of organizations)")

coalitions_coded %>% 
  mutate(comments = comments - coalition_size) %>%
  ggplot() + 
  aes(x = log(coalition_size), y = log(coalition_comments)) +
  geom_point() + 
  geom_smooth(method = "lm") + 
  labs(y = "Logged Mass Comments",
       x = "Logged Coalition Size\n(number of organizations)")
```

<!--
## Machine-coded Data

> IN PROGRESS

**Dependent variable:** *The percent change in policy text*...

**Explanatory variables:** The *total number of comments*...

-->


---
<!--
# Extra Methods



---



## DV = Comments from members of Congress


```{hypothesis oversight, echo = TRUE}
The scale of public engagement moderates elected officials' engagement in agency rulemaking
engagement.
```

> Preliminary finding: The size of the lobbying coalition (the number of organizations) is positively correlated with the number of members of Congress who engage. When we account for variation in coalition size, there is no evidence that the total number of comments is related to the number of comments from members of Congress.

The simplest model of the relationship between congressional attention and public attention is a model estimating the count of legislator letters as a function of features of the rulemaking, including the total number of public comments. The number of letters from members of Congress would be a count process; this would be a Poisson or negative binomial regression.

In equation \@ref(eq:oversight1), $y_{j}$ is a count of the number of legislator comments on a proposed rule $j$, $\beta_1$ is the effect of a one-unit increase in the logged number of public comments on proposed rule $j$, and $\eta$ is a vector of coefficients on other factors ($X_{j}$) that may lead legislators to comment.

$$
y_{j}= \beta_0 + \beta_1 \text{log(Public comments)}_{j} + \eta X_{j} + \epsilon_{j} (\#eq:oversight1)
$$

---

Alternatively, if we want to control for legislator characteristics that may make them more or less likely to comment on a rule, we can make members of Congress the unit of analysis. The dependent variable is now whether or not a given legislator $i$ commented on the proposed rule $j$. The relationship between public engagement and legislator engagement can be modeled by Equation \@ref(eq:oversight2), where $Pr(Comment_{ij})$ is the probability that legislator $i$ comments on a proposed rule $j$, $\beta_1$ is the effect of a one-unit increase in the logged number of public comments on proposed rule $j$, and $\eta$ is a vector of coefficients on other factors ($X_{ij}$) that may affect whether a legislator engages.


$$logit(Pr(\text{Legislator comment}_{ij})) = \beta_0 + \beta_1 \text{log(Public comments)}_{ij} + \eta X_{ij} + \epsilon_{ij}
(\#eq:oversight2)$$



---

```{hypothesis beacon, echo = TRUE}
Public pressure campaigns attract
oversight from allies. The more comments supporting a position, the more
likely principals holding that position are to engage.
```

```{hypothesis warning, echo = TRUE}
Public pressure campaigns
reduce oversight from opponents. The more comments opposing a position,
the less likely principals holding that position are to engage.
```

The simplest model of the relationship between congressional attention and public support or opposition to a proposed rule would be to model the net count of legislator letters supporting and opposing the proposed as a function of features of the rulemaking, including the net number of public comments supporting and opposing. As the number of letters from members of Congress would be a count process, this would be Poisson or negative binomial regression.

The model is the same as equation \@ref(eq:oversight1) except that $y_{j}$ is now the *net* number of legislator comments supporting a proposed rule $j$, and $\beta_1$ is now the effect of a one-unit increase in the logged *net* number of public comments supporting proposed rule $j$.

---

With a measure of the likely position on each rule (for example, if promulgated by a co-partisan administration), the individual legislator can be the unit of analysis. The probability that legislator $i$ will comment on rule $j$, given their position $p_{ij}$ on a proposed rule $j$ ($Pr(Comment_{ij}i|p_{ij})$), is modeled in equation \@ref(eq:oversight4). Hypothesis \@ref(hyp:beacon) implies that $\beta_1$ is positive and
Hypothesis \@ref(hyp:warning) implies that $\beta_2$ is negative.


$$logit(Pr(\text{Legislator Comment}_{ij}|p_{ij})) = \beta_0 + \beta_1 \text{Comments supporting } p_{ij} + \beta_2 \text{Comments opposing } p_{ij} + \eta X_{ij} + \epsilon_{ij}
(\#eq:oversight4)$$

-->

# Additional Results


## Interact quadratic term with coalition type 

Models 5 and 6 in the main coalition-level results (Table 3.7 in Chapter 3, reproduced as Table \@ref(tab:mc-success) above) are estimated without interaction terms for the number of comments and coalition type. Table \@ref(tab:mcfe-success-quadratic) shows that when we include these interactions 
$R^2$ and Log-Likelihood are unchanged and errors on estimates for the numbrer of comments comments$^2$ both increase. Still, Table \@ref(tab:mcfe-success-quadratic) may be a better specification because we do expect different 


```{r mcfe-success-quadratic}
#mcfe-success

# coalition success with agency and president FE
mc1 <- feols(coalition_success ~ 
          campaign_*coalition_type + 
          # campaign_*coalition_business_ +
          # log(comments + 1)*coalition_type
          # log(comments + 1)*coalition_business_ + 
          # comments * coalition_type + 
          # comments^2 * coalition_type +
          # comments^2 * coalition_business +
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency + president, #+ president, 
        data = coalitions_coded)

mc2 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency + president, #+ president, 
        data = coalitions_coded)

mc3 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency + president,# + president, 
        data = coalitions_coded)

mc4 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          #campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency + president,# + president, 
        data = coalitions_coded)

mc5 <- feols(coalition_success ~ 
          # campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          comments100k*coalition_type + 
          coalition_type*comments100k^2 + #m6          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency + president, 
        data = coalitions_coded)

mc6 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          comments100k*coalition_business_ + 
          coalition_business_*comments100k^2 + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency + president, 
        data = coalitions_coded)

modelsFE <- list(mc1, mc2, mc3, mc4, mc5, mc6)

# paper table fixest
modelsummary::modelsummary( modelsFE, 
                            stars = TRUE, 
                            #coef_map =
                            coef_rename =  cm,
                            gof_omit = "R2 .*|IC",
                          add_rows = rowsFE, 
                          title = "OLS Models of Coalition-Level Lobbying Success",
                          notes = "") #%>% kable2(file = "mc-success")
```

```{r mcfe-success-quadratic-predicted, fig.height=3, fig.width=4.5}
#mcfe-success-quadratic-pred
top10 = coalitions_coded %>% distinct(docket_id, agency) %>% count(agency) %>% slice_max(order_by = n, n =4) %>% pull(agency)

values = coalitions_coded %>% 
  expand(president, 
         #comments = c(0,1,10,100,1000,10000,100000),
         comments100k = seq(0, 10, by = .1),
         #coalition_business_,
         coalition_type,
         coalition_congress = 0,
         coalition_ = TRUE,
         coalition_size = 10,
         Coalition_Position,
         coalition_unopposed = TRUE,
         agency = top10
         ) %>% 
  mutate(agencyXpresident = paste(agency, president))

plot_quadratic <-  function(model){ 
  
  model %>% 
broom::augment(newdata = values, se_fit = TRUE) %>% 
  filter(president != "Bush",
         .fitted < 2) %>% 
  mutate(president = as.character(president)) %>%
  drop_na() %>% 
  ggplot() + 
  aes(x = comments100k*100, y = .fitted, color = coalition_type,
      #label = agency, 
      linetype = agency) + 
  #geom_point() + 
  geom_line() + 
  facet_grid(Coalition_Position ~ president) +
  labs(x = "Mass comments (Thousands)",
       y = "Predicted Lobbying Success",
       color = "Coalition Type", 
       linetype = "Agency")
}
plot_quadratic(mc5)
```


## Split samples

When we estimate the same models as those presented in Table \@ref(tab:mc-success) with the sample split by whether the coalition supports or opposes the rule, results are surprisingly consistent for both samples. While some effect sizes change, none of the estimated that is significant at the .05 level changes sign. 

Coalition size is a stronger predictor for supportive coalitions than opposing ones.

The negative relationship between using a *pressure campaign* and *lobbying success* appears to be mostly a function of campaigns opposing proposed rules. This aligns with the conclusion that campaigns that fail to affect policy are often "going down fighting." However, the linear and quadratic terms for the number of mass comments are similar magnitudes, suggesting that very large coalitions opposing proposed rules may be more successful than smaller ones. 

###  Coalitions Supporting Proposed Rules

```{r mcfe-success-pro, fig.height=3, fig.width=4.5}
#mc-success-pro
pro <- filter(coalitions_coded, Coalition_Position == "Supports Rule")
con <- filter(coalitions_coded, Coalition_Position == "Opposes Rule")

# coalition success with agency and president FE
mc1pro <- feols(coalition_success ~ 
          campaign_*coalition_type + 
          # campaign_*coalition_business_ +
          # log(comments + 1)*coalition_type
          # log(comments + 1)*coalition_business_ + 
          # comments * coalition_type + 
          # comments^2 * coalition_type +
          # comments^2 * coalition_business +
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          #Coalition_Position + 
          # comment_length + 
          coalition_unopposed #+ coalition_congress
          # Agency and president FE 
          | agency + president, #+ president, 
        data = pro)

mc2pro <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          #Coalition_Position + 
          # comment_length + 
          coalition_unopposed#+ coalition_congress
          # Agency and president FE 
          | agency + president, #+ president, 
        data = pro)

mc3pro <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          #Coalition_Position + 
          # comment_length + 
          coalition_unopposed#+ coalition_congress
          # Agency and president FE 
          | agency + president,# + president, 
        data = pro)

mc4pro <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          #campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          #Coalition_Position + 
          # comment_length + 
          coalition_unopposed#+ coalition_congress
          # Agency and president FE 
          | agency + president,# + president, 
        data = pro)

mc5pro <- feols(coalition_success ~ 
          # campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          comments100k + comments100k^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          #Coalition_Position + 
          # comment_length + 
          coalition_unopposed#+ coalition_congress
          # Agency and president FE 
          | agency + president, 
        data = pro)

mc6pro <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          comments100k + comments100k^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          #Coalition_Position + 
          # comment_length + 
          coalition_unopposed#+ coalition_congress
          # Agency and president FE 
          | agency + president, 
        data = pro)


modelsFEpro <- list(mc1pro, mc2pro, mc3pro, mc4pro, mc5pro, mc6pro)

# paper table fixest
modelsummary::modelsummary( modelsFEpro, 
                            stars = TRUE, 
                            #coef_map =
                            coef_rename =  cm,
                            gof_omit = "R2 .*|IC",
                          add_rows = rowsFE, 
                          title = "OLS Models of Coalition-Level Lobbying Success for Coalitions Supporting Proposed Rules",
                          notes = "")

plot_quadratic(mc5pro)
```

###  Coalitions Opposing Proposed Rules

```{r mcfe-success-con, fig.height=3, fig.width=4.5}
#mc-success-con

# coalition success with agency and president FE
mc1con <- feols(coalition_success ~ 
          campaign_*coalition_type + 
          # campaign_*coalition_business_ +
          # log(comments + 1)*coalition_type
          # log(comments + 1)*coalition_business_ + 
          # comments * coalition_type + 
          # comments^2 * coalition_type +
          # comments^2 * coalition_business +
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          #Coalition_Position + 
          # comment_length + 
          coalition_unopposed #+ coalition_congress
          # Agency and president FE 
          | agency + president, #+ president, 
        data = con)

mc2con <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          #Coalition_Position + 
          # comment_length + 
          coalition_unopposed#+ coalition_congress
          # Agency and president FE 
          | agency + president, #+ president, 
        data = con)

mc3con <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          #Coalition_Position + 
          # comment_length + 
          coalition_unopposed#+ coalition_congress
          # Agency and president FE 
          | agency + president,# + president, 
        data = con)

mc4con <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          #campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          #Coalition_Position + 
          # comment_length + 
          coalition_unopposed#+ coalition_congress
          # Agency and president FE 
          | agency + president,# + president, 
        data = con)

mc5con <- feols(coalition_success ~ 
          # campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          comments100k + comments100k^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          #Coalition_Position + 
          # comment_length + 
          coalition_unopposed#+ coalition_congress
          # Agency and president FE 
          | agency + president, 
        data = con)

mc6con <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          comments100k + comments100k^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          #Coalition_Position + 
          # comment_length + 
          coalition_unopposed#+ coalition_congress
          # Agency and president FE 
          | agency + president, 
        data = con)


modelsFEcon <- list(mc1con, mc2con, mc3con, mc4con, mc5con, mc6con)

# paper table fixest
modelsummary::modelsummary( modelsFEcon, 
                            stars = TRUE, 
                            #coef_map =
                            coef_rename =  cm,
                            gof_omit = "R2 .*|IC",
                          add_rows = rowsFE, 
                          title = "OLS Models of Coalition-Level Lobbying Success for Coalitions Opposing Proposed Rules",
                          notes = "")

plot_quadratic(mc5con)
```

###  Coalitions That Used Public Pressure Campaigns

```{r mcfe-success-campaign, fig.height=3, fig.width=4.5}
#mc-success-pro
campaign <- filter(coalitions_coded, campaign_)

# coalition success with agency and president FE
mc1campaign <- feols(coalition_success ~ 
          campaign_*coalition_type + 
          # campaign_*coalition_business_ +
          # log(comments + 1)*coalition_type
          # log(comments + 1)*coalition_business_ + 
          # comments * coalition_type + 
          # comments^2 * coalition_type +
          # comments^2 * coalition_business +
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          #Coalition_Position + 
          # comment_length + 
          coalition_unopposed #+ coalition_congress
          # Agency and president FE 
          | agency + president, #+ president, 
        data = campaign)

mc2campaign <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          #Coalition_Position + 
          # comment_length + 
          coalition_unopposed#+ coalition_congress
          # Agency and president FE 
          | agency + president, #+ president, 
        data = campaign)

mc3campaign <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          #Coalition_Position + 
          # comment_length + 
          coalition_unopposed#+ coalition_congress
          # Agency and president FE 
          | agency + president,# + president, 
        data = campaign)

mc4campaign <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          #campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          #Coalition_Position + 
          # comment_length + 
          coalition_unopposed#+ coalition_congress
          # Agency and president FE 
          | agency + president,# + president, 
        data = campaign)

mc5campaign <- feols(coalition_success ~ 
          # campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          comments100k + comments100k^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          #Coalition_Position + 
          # comment_length + 
          coalition_unopposed#+ coalition_congress
          # Agency and president FE 
          | agency + president, 
        data = campaign)

mc6campaign <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          comments100k + comments100k^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          #Coalition_Position + 
          # comment_length + 
          coalition_unopposed#+ coalition_congress
          # Agency and president FE 
          | agency + president, 
        data = campaign)


modelsFEcampaign <- list(mc1campaign, mc2campaign, mc3campaign, mc4campaign, mc5campaign, mc6campaign)

# paper table fixest
modelsummary::modelsummary( modelsFEcampaign, 
                            stars = TRUE, 
                            #coef_map =
                            coef_rename =  cm,
                            gof_omit = "R2 .*|IC",
                          add_rows = rowsFE, 
                          title = "OLS Models of Coalition-Level Lobbying Success for Coalitions that Used a Mass Comment Campaign",
                          notes = "")

plot_quadratic(mc5campaign)
```

<!--
## Add opposing campaign

> TODO
-->

## Add support from members of Congress


```{r mcfe-success-congress, fig.height=3, fig.width=4.5}
#mc-success-congress

# coalition success with agency and president FE
mc1 <- feols(coalition_success ~ 
          campaign_*coalition_type + 
          # campaign_*coalition_business_ +
          # log(comments + 1)*coalition_type
          # log(comments + 1)*coalition_business_ + 
          # comments * coalition_type + 
          # comments^2 * coalition_type +
          # comments^2 * coalition_business +
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed + coalition_congress
          # Agency and president FE 
          | agency + president, #+ president, 
        data = coalitions_coded)

mc2 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed+ coalition_congress
          # Agency and president FE 
          | agency + president, #+ president, 
        data = coalitions_coded)

mc3 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed+ coalition_congress
          # Agency and president FE 
          | agency + president,# + president, 
        data = coalitions_coded)

mc4 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          #campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed+ coalition_congress
          # Agency and president FE 
          | agency + president,# + president, 
        data = coalitions_coded)

mc5 <- feols(coalition_success ~ 
          # campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          comments100k + comments100k^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed+ coalition_congress
          # Agency and president FE 
          | agency + president, 
        data = coalitions_coded)

mc6 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          comments100k + comments100k^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed+ coalition_congress
          # Agency and president FE 
          | agency + president, 
        data = coalitions_coded)


modelsFE <- list(mc1, mc2, mc3, mc4, mc5, mc6)

# paper table fixest
modelsummary::modelsummary( modelsFE, 
                            stars = TRUE, 
                            #coef_map =
                            coef_rename =  cm,
                            gof_omit = "R2 .*|IC",
                          add_rows = rowsFE, 
                          title = "OLS Models of Coalition-Level Lobbying Success",
                          notes = "")

plot_quadratic(mc5)

```



## President*agency fixed effects
```{r mcfe-success-2-way-fe, fig.height=3, fig.width=4.5}
#mc-success-2-way-fe
coalitions_coded %<>% 
  mutate(agencyXpresident = paste(agency, president))

# coalition success with agency and president FE
mc1 <- feols(coalition_success ~ 
          campaign_*coalition_type + 
          # campaign_*coalition_business_ +
          # log(comments + 1)*coalition_type
          # log(comments + 1)*coalition_business_ + 
          # comments * coalition_type + 
          # comments^2 * coalition_type +
          # comments^2 * coalition_business +
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agencyXpresident, #+ president, 
        data = coalitions_coded)

mc2 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agencyXpresident, #+ president, 
        data = coalitions_coded)

mc3 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agencyXpresident,# + president, 
        data = coalitions_coded)

mc4 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          #campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agencyXpresident,# + president, 
        data = coalitions_coded)

mc5 <- feols(coalition_success ~ 
          # campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          comments100k + comments100k^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agencyXpresident, 
        data = coalitions_coded)

mc6 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          comments100k + comments100k^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agencyXpresident, 
        data = coalitions_coded)

# paper table fixest
modelsummary::modelsummary( modelsFE, 
                            stars = TRUE, 
                            #coef_map =
                            coef_rename =  cm,
                            gof_omit = "R2 .*",
                          add_rows = rowsFE, 
                          title = "OLS Models of Coalition-Level Lobbying Success",
                          notes = "")

plot_quadratic(mc5)
```


## President indicators

```{r mcfe-success-president, fig.height=3, fig.width=4.5}
# mc-success-president

# coalition success with agency and president FE
mc1 <- feols(coalition_success ~ 
          campaign_*coalition_type + 
            president + 
          # campaign_*coalition_business_ +
          # log(comments + 1)*coalition_type
          # log(comments + 1)*coalition_business_ + 
          # comments * coalition_type + 
          # comments^2 * coalition_type +
          # comments^2 * coalition_business +
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency, #+ president, 
        data = coalitions_coded)

mc2 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          campaign_*coalition_business_ +
           president +# m2
          # log(comments + 1)*coalition_type # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency, #+ president, 
        data = coalitions_coded)

mc3 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          log(comments + 1)*coalition_type+ # m3
            president +
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency,# + president, 
        data = coalitions_coded)

mc4 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          #campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          log(comments + 1)*coalition_business_ + # m4
           president+
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency,# + president, 
        data = coalitions_coded)

mc5 <- feols(coalition_success ~ 
          # campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          comments100k + comments100k^2 + coalition_type+ #m5
          president +
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency , 
        data = coalitions_coded)

mc6 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          comments100k + comments100k^2 + coalition_business_+ #m6
           president+
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency, 
        data = coalitions_coded)

models_president <- list(mc1, mc2, mc3, mc4, mc5, mc6)


# paper table fixest
modelsummary::modelsummary( models_president, 
                            stars = TRUE, 
                            #coef_map =
                            coef_rename =  cm,
                            gof_omit = "R2 .*",
                          add_rows = rowsFE, 
                          notes = "") %>% 
  row_spec(row = 1, bold = T) #%>% kable2(file = "mc-success")

plot_quadratic(mc5)

```

### Two-way interaction 
```{r mcfe-success-president2, fig.height=3, fig.width=4.5}
# mc-success-president2

# coalition success with agency and president FE
mc1 <- feols(coalition_success ~ 
          campaign_*coalition_type + 
            coalition_type*president + 
          # campaign_*coalition_business_ +
          # log(comments + 1)*coalition_type
          # log(comments + 1)*coalition_business_ + 
          # comments * coalition_type + 
          # comments^2 * coalition_type +
          # comments^2 * coalition_business +
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency, #+ president, 
        data = coalitions_coded)

mc2 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          campaign_*coalition_business_ +
            coalition_business_*president +# m2
          # log(comments + 1)*coalition_type # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency, #+ president, 
        data = coalitions_coded)

mc3 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          log(comments + 1)*coalition_type+ # m3
            coalition_type*president +
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency,# + president, 
        data = coalitions_coded)

mc4 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          #campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          log(comments + 1)*coalition_business_ + # m4
            coalition_business_*president+
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency,# + president, 
        data = coalitions_coded)

mc5 <- feols(coalition_success ~ 
          # campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          comments100k*coalition_type + coalition_type*comments100k^2 + #m5
            coalition_type*president +
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency , 
        data = coalitions_coded)

mc6 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          comments100k + comments100k^2 + coalition_business_+ #m6
            coalition_business_*president+
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency, 
        data = coalitions_coded)

models_president <- list(mc1, mc2, mc3, mc4, mc5, mc6)

# paper table fixest
modelsummary::modelsummary( models_president, 
                            stars = TRUE, 
                            #coef_map =
                            coef_rename =  cm,
                            gof_omit = "R2 .*",
                          add_rows = rowsFE, 
                          notes = "") %>% 
  row_spec(row = 1, bold = T) #%>% kable2(file = "mc-success")

plot_quadratic(mc5)
```

### Three-way interaction 

```{r mcfe-success-president3, fig.height=3, fig.width=4.5}
# mc-success-president3

# coalition success with agency and president FE
mc1 <- feols(coalition_success ~ 
          campaign_*president*coalition_type + 
          # campaign_*coalition_business_ +
          # log(comments + 1)*coalition_type
          # log(comments + 1)*coalition_business_ + 
          # comments * coalition_type + 
          # comments^2 * coalition_type +
          # comments^2 * coalition_business +
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency, #+ president, 
        data = coalitions_coded)

mc2 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          campaign_*coalition_business_*president + # m2
          # log(comments + 1)*coalition_type # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency, #+ president, 
        data = coalitions_coded)

mc3 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          log(comments + 1)*coalition_type*president + # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency,# + president, 
        data = coalitions_coded)

mc4 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          #campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          log(comments + 1)*coalition_business_*president + # m4
          # comments + comments^2 + coalition_type + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency,# + president, 
        data = coalitions_coded)

mc5 <- feols(coalition_success ~ 
          # campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          comments100k*coalition_type*president + coalition_type*president*comments100k^2 + coalition_type*president + #m5
          # comments + comments^2 + coalition_business_ + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency , 
        data = coalitions_coded)

mc6 <- feols(coalition_success ~ 
          #campaign_*coalition_type + # m1
          # campaign_*coalition_business_ + # m2
          # log(comments + 1)*coalition_type + # m3
          # log(comments + 1)*coalition_business_ + # m4
          # comments + comments^2 + coalition_type + #m5
          comments100k + comments100k^2 + coalition_business_*president + #m6
          coalition_ + log(coalition_size) + #  coalition_size^2 + 
          Coalition_Position + 
          # comment_length + 
          coalition_unopposed
          # Agency and president FE 
          | agency, 
        data = coalitions_coded)

models_president <- list(mc1, mc2, mc3, mc4, mc5, mc6)


# paper table fixest
modelsummary::modelsummary( models_president, 
                            stars = TRUE, 
                            #coef_map =
                            coef_rename =  cm,
                            gof_omit = "R2 .*",
                          add_rows = rowsFE, #FIXME rename rowsFE lobbying success
                          notes = "") %>% 
  row_spec(row = 1, bold = T) #%>% kable2(file = "mc-success")

plot_quadratic(mc5)

```


```{r mcfe-coef, include = FALSE,  fig.width=6, fig.height=2, out.width = "100%", fig.cap= "OLS Model of Coalition Lobbying Sucess with Hand-coded Data"}
# My preferred model:
# model-success-plot

mc1 %>%
  tidy(conf.int = TRUE) %>% 
  filter(term != "(Intercept)") %>% 
  left_join(cm2) %>% #select(term, Term)
  ggplot() + 
  geom_hline(yintercept = 0, color = "grey") + 
  aes(x = Term, 
      y = estimate, 
      ymin = conf.low, 
      ymax = conf.high) + 
  geom_pointrange( )  + 
  coord_flip() +
  labs(y = "Lobbying Success", 
       x = "") 
```

## Mixed effects / hierarchical models

### Coalition-level Hierarchical Models

#### Random intercept models

With random effects for agency and president, results look very similar to the fixed-effects models.

```{r mcme, fig.height=3, fig.width=4.5}
#mcme
mc_data <- coalitions_coded

# mixed model with random intercepts for president and agency
mcme1 = lmer(coalition_success ~ 
               campaign_*coalition_type +
              Coalition_Position + 
              log(coalition_size) + 
              (1|agency) + (1|president), # random intercept for each agency and president 
               data = mc_data)

# with business indicator
mcme2 = lmer(coalition_success ~ campaign_*coalition_business_ +
              Coalition_Position + 
              log(coalition_size) + 
              (1|agency) +
               (1|president),
               data = mc_data)

# with log 
mcme3 = lmer(coalition_success ~ log(comments + 1)*coalition_type +
              Coalition_Position + 
              log(coalition_size) + 
              (1|agency) + (1|president), 
               data = mc_data)

mcme4 = lmer(coalition_success ~ 
               log(comments + 1)*coalition_business_ +
              Coalition_Position + 
              log(coalition_size) + 
              (1|agency) + (1|president), 
               data = mc_data)

# with quadratic
mcme5 = lmer(coalition_success ~ 
               comments100k*coalition_type +
               comments100k^2*coalition_type + 
              Coalition_Position + 
              log(coalition_size) + 
              (1|agency) + (1|president), 
               data = mc_data)

mcme6 = lmer(coalition_success ~
               comments100k*coalition_business_ +
               comments100k^2*coalition_business_ + 
               Coalition_Position + 
              log(coalition_size) + 
              (1|agency) + (1|president), 
               data = mc_data)



# coef plot 
# broom.mixed::tidy(mcme1) %>% 
#   mutate(term = ifelse(str_detect(term, "sd__.Int"), paste(group, term), term)) %>%  
#   dwplot + geom_vline(xintercept=0,lty=2)

# models table 
models_mcme <- list(mcme1, mcme2, mcme3, mcme4, mcme5, mcme6)

# paper table random intercepts 
modelsummary::modelsummary( models_mcme, 
                            stars = TRUE, 
                            coef_rename =  cm,
                            coef_omit = "sd__.Int",
                            gof_omit = "R2 .*",
                          add_rows = mc_rows6, 
                          notes = "") %>% 
  row_spec(row = 1, bold = T) #%>% kable2(file = "mc-success")

# plot_quadratic(mcme5)
```

#### Random effects 

I now allow the effect of campaigns to vary across agencies and presidents.

> TODO 

```{r mcme-hierarchical, eval=FALSE, fig.height=3, fig.width=4.5}
#mcme-hierarchical 

# mixed model with random slopes for campaign by president and agency 
mcme1 = lmer(coalition_success ~ 
               campaign_ +
               #TODO # random intercept for each agency and president 
               data = mc_data)

# mixed model with random effects for president and agency
mcme1 = lmer(coalition_success ~ campaign_*coalition_type +
              Coalition_Position + 
              log(coalition_size) + 
               (1|agency) +
               #FIXME make effect of campaign vary by agency and president? 
              #(campaign_|agency) + 
               (1|president), # random intercept for each coalition
               data = mc_data)

mcme2 = lmer(coalition_success ~ campaign_*coalition_business_ +
              Coalition_Position + 
              log(coalition_size) + 
              (1|agency) + (1|president), # random intercept for each coalition
               data = mc_data)

mcme3 = lmer(coalition_success ~ log(comments + 1)*coalition_type +
              Coalition_Position + 
              log(coalition_size) + 
              (1|agency) + (1|president), # random intercept for each coalition
               data = mc_data)

mcme4 = lmer(coalition_success ~ log(comments + 1)*coalition_business_ +
              Coalition_Position + 
              log(coalition_size) + 
              (1|agency) + (1|president), # random intercept for each coalition
               data = mc_data)

mcme5 = lmer(coalition_success ~ comments100k*coalition_type +  comments100k^2*coalition_type + 
              Coalition_Position + 
              log(coalition_size) + 
              (1|agency) + (1|president), # random intercept for each coalition
               data = mc_data)

mcme6 = lmer(coalition_success ~ comments100k*coalition_business_ +  comments100k^2*coalition_business_ + 
              Coalition_Position + 
              log(coalition_size) + 
              (1|agency) + (1|president), # random intercept for each coalition
               data = mc_data)



# coef plot 
# broom.mixed::tidy(mcme1) %>% 
#   mutate(term = ifelse(str_detect(term, "sd__.Int"), paste(group, term), term)) %>%  
#   dwplot + geom_vline(xintercept=0,lty=2)

# Table 
models_mcme <- list(mcme1, mcme2, mcme3, mcme4, mcme5, mcme6)

# paper table random effects
modelsummary::modelsummary( models_mcme, 
                            stars = TRUE, 
                            coef_rename =  cm,
                            coef_omit = "sd__.Int",
                            gof_omit = "R2 .*",
                          add_rows = mc_rows6, 
                          notes = "") %>% 
  row_spec(row = 1, bold = T) #%>% kable2(file = "mc-success")

# plot_quadratic(mcme5)
```

### Organization-level Hierarchical Models

Because organizations are nested in coalitions, I estimate a hierarchical model grouping by coalition. 

```{r mome-coef}
#mome
#FIXME us this in all org-level models
comments_coded %<>% mutate(comments100k = coalition_comments/100000)


mo_data <- comments_coded %>% 
  drop_na(coalition_type, Position) %>% 
  filter(comment_type == "Org") %>% 
  distinct(org_name, docket_id, success, coalition_type, coalition_size, Position, comments100k, president, campaign_, coalition, agency) %>% filter(president != "Bush")  %>% droplevels()


# mixed model with random slopes for campaign by president and agency 
mcme1 = lme(success ~ 
               campaign_,
               random = ~campaign_|agency,
            na.action = "na.omit", 
               data = mo_data)

# mixed model with random effects for coalition
mome1 = lmer(success ~ campaign_*coalition_type+
              Position + 
              log(coalition_size) + 
              (1|coalition) + (1|agency) + 
               (1|president), # random intercept for each coalition
               data = mo_data)

mome2 = lmer(success ~ comments100k*coalition_type +
               coalition_type*(comments100k^2) +
              Position + 
              log(coalition_size) + 
              (1|coalition) + (1|agency) + 
               (1|president), # random intercept for each coalition
               data = mo_data)

mome3 = lmer(success ~ comments100k*coalition_type*president +
              coalition_type*president*comments100k^2 +
              Position + 
              log(coalition_size) + 
              (1|coalition) + (1|agency), # random intercept for each coalition
               data = mo_data)

models_mome <- list(mome1, mome2, mome3)

# paper table random effects
modelsummary::modelsummary( models_mome, 
                            stars = TRUE, 
                            coef_rename =  cm,
                            coef_omit = "sd__.Int",
                            gof_omit = "R2 .*",
                          add_rows = success_rows3, 
                          notes = "") %>% 
  row_spec(row = 1, bold = T) #%>% kable2(file = "mc-success")

# coef plot
# broom.mixed::tidy(mome1) %>% 
#   mutate(term = ifelse(str_detect(term, "sd__.Int"), paste(group, term), term)) %>%  
#   dwplot + geom_vline(xintercept=0,lty=2)

```

```{r mome, fig.height=3, fig.width=5.5}
# tidy(mcme1, conf.int = T)

# tidy(mcme1,effects="fixed")

#fixef(mcme1) #is the canonical way to extract coefficients from mixed models 

# you can get the full coefficient table with coef(summary(m)); if you have loaded lmerTest before fitting the model, or convert the model after fitting (and then loading lmerTest) via coef(summary(as(m,"merModLmerTest"))), then the coefficient table will include p-values. (The coefficient table is a matrix; you can extract the columns via e.g. ctab[,"Estimate"], ctab[,"Pr(>|t|)"], or convert the matrix to a data frame and use $-indexing.)

# get likelihood profile confidence intervals via 
#confint(mcme1) 
#; these may be computationally intensive. If you use confint(m, method="Wald") you'll get the standard +/- 1.96SE confidence intervals. (lme uses intervals(m) instead of confint().)

#broom.mixed::tidy(mcme1,effects="fixed")
# gives you a table with estimates, standard errors, etc.
# tidy(as(m,"merModLmerTest"), effects="fixed") (or fitting with lmerTest in the first place) includes p-values
# adding conf.int=TRUE gives (Wald) CIs
# adding conf.method="profile" (along with conf.int=TRUE) gives likelihood profile CIs
# You can also get confidence intervals by parametric bootstrap (method="boot"), which is considerably slower but more accurate in some circumstances.

# A data frame of values at which to estimate probabilities:

values <- mo_data %>% 
  tidyr::expand(comments100k = seq(1, 10, by = .1) %>% as.numeric(),
                #org_name = c("Sierra Club"),
                campaign_ = campaign_,
                coalition_type = coalition_type,
                coalition_size = 100 %>% as.integer(),
                agency = "BSEE" ,
                Position = Position,
                #docket_id = docket_id,
                coalition = c("Sierra Club", "Axcess Financial", "Aclu", "American Petroleum Institute"),
                president = president) %>%
  filter( (coalition %in% c("Axcess Financial", "American Petroleum Institute") & coalition_type == "Private") | (!coalition %in% c("Axcess Financial", "American Petroleum Institute") & coalition_type == "Public"))

# names(mo_data) %in% names(values)
# 
# tibble(class = map(values, class) %>% unlist(),
#        name = names(values) ) %>% 
#   full_join(
#     tibble(class = map(mo_data, class) %>% unlist(),
#            name = names(mo_data)))

broom.mixed::augment(mome1, 
                     type.predict = "response",
                      newdata = values,
                     se_fit = TRUE) %>% #names()
  distinct(coalition, coalition_type, campaign_, .fitted, Position, president) %>%
  #filter(`log(coalition_size)`==0) %>% 
  ggplot() + 
  aes(x = campaign_, y = .fitted, color =coalition_type,
      shape = coalition) +
  geom_point() +
  #geom_text(check_overlap = T) + 
        facet_grid(Position ~ president)+
  labs(x = "Mass comment campaign",
       shape = "Coalition",
       y = "Predicted Lobbying Success",
       color = "Coalition Type", 
       linetype = "Agency") 


broom.mixed::augment(mome2, 
                     type.predict = "response",
                      newdata = values,
                     se_fit = TRUE) %>% #names()
  distinct(coalition, coalition_type, comments100k, .fitted, Position, president) %>%
  #filter(`log(coalition_size)`==0) %>% 
  ggplot() + 
  aes(x = comments100k*100, 
      y = .fitted, 
      color =coalition_type,
      linetype = coalition) +
  #geom_point() +
  geom_line() +
        facet_grid(Position ~ president)+
  labs(x = "Mass comments (Thousands)",
       y = "Predicted Lobbying Success",
       color = "Coalition Type", 
       linetype = "Coalition")



```

<!--
#### With Stan

```{r mo-stan, eval = FALSE, cache = TRUE}
library(brms)

mo_data %<>% mutate(campaign = campaign_ %>% as.numeric())

fit2 <-
  brm(data = mo_data,
      family = binomial(link = logit),
      campaign | trials(coalition_size) ~ 1 + (1 | coalition) + (1 | coalition:agency),
      prior = c(prior(normal(0, 1.5), class = Intercept),
                prior(normal(0, 1), class = sd)),
      iter = 3500, warmup = 500, chains = 3, cores = 3,
      control = list(adapt_delta = .99),
      seed = 9)

plot(fit2)


```
-->